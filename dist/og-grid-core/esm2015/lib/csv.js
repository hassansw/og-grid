import { getCellValue } from './engine';
function escapeCsv(v) {
    var s = v == null ? '' : String(v);
    // Escape quotes by doubling them
    if (s.indexOf('"') >= 0)
        s = s.replace(/"/g, '""');
    // Wrap if contains commas/newlines/quotes
    if (/[",\n\r]/.test(s))
        s = '"' + s + '"';
    return s;
}
export function toCsv(rows, cols) {
    var headers = cols.map(function (c) {
        return escapeCsv(c.headerName != null ? c.headerName : String(c.field));
    });
    var lines = [];
    lines.push(headers.join(','));
    for (var i = 0; i < rows.length; i++) {
        var r = rows[i];
        var line = cols.map(function (c) {
            var val = getCellValue(c, r);
            if (c.valueFormatter)
                val = c.valueFormatter(val, r);
            return escapeCsv(val);
        });
        lines.push(line.join(','));
    }
    return lines.join('\n');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3N2LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvb2ctZ3JpZC1jb3JlL3NyYy9saWIvY3N2LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFeEMsU0FBUyxTQUFTLENBQUMsQ0FBTTtJQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuQyxpQ0FBaUM7SUFDakMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkQsMENBQTBDO0lBQzFDLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFBRSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7SUFDMUMsT0FBTyxDQUFDLENBQUM7QUFDYixDQUFDO0FBRUQsTUFBTSxVQUFVLEtBQUssQ0FBSSxJQUFTLEVBQUUsSUFBb0I7SUFDcEQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7UUFDOUIsT0FBTyxTQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM1RSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksS0FBSyxHQUFhLEVBQUUsQ0FBQztJQUN6QixLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUU5QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUNsQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7WUFDM0IsSUFBSSxHQUFHLEdBQUcsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsQ0FBQyxjQUFjO2dCQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNyRCxPQUFPLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztRQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0tBQzlCO0lBRUQsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2x1bW5EZWYgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IGdldENlbGxWYWx1ZSB9IGZyb20gJy4vZW5naW5lJztcblxuZnVuY3Rpb24gZXNjYXBlQ3N2KHY6IGFueSk6IHN0cmluZyB7XG4gICAgdmFyIHMgPSB2ID09IG51bGwgPyAnJyA6IFN0cmluZyh2KTtcbiAgICAvLyBFc2NhcGUgcXVvdGVzIGJ5IGRvdWJsaW5nIHRoZW1cbiAgICBpZiAocy5pbmRleE9mKCdcIicpID49IDApIHMgPSBzLnJlcGxhY2UoL1wiL2csICdcIlwiJyk7XG4gICAgLy8gV3JhcCBpZiBjb250YWlucyBjb21tYXMvbmV3bGluZXMvcXVvdGVzXG4gICAgaWYgKC9bXCIsXFxuXFxyXS8udGVzdChzKSkgcyA9ICdcIicgKyBzICsgJ1wiJztcbiAgICByZXR1cm4gcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvQ3N2PFQ+KHJvd3M6IFRbXSwgY29sczogQ29sdW1uRGVmPFQ+W10pOiBzdHJpbmcge1xuICAgIHZhciBoZWFkZXJzID0gY29scy5tYXAoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgcmV0dXJuIGVzY2FwZUNzdihjLmhlYWRlck5hbWUgIT0gbnVsbCA/IGMuaGVhZGVyTmFtZSA6IFN0cmluZyhjLmZpZWxkKSk7XG4gICAgfSk7XG5cbiAgICB2YXIgbGluZXM6IHN0cmluZ1tdID0gW107XG4gICAgbGluZXMucHVzaChoZWFkZXJzLmpvaW4oJywnKSk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHIgPSByb3dzW2ldO1xuICAgICAgICB2YXIgbGluZSA9IGNvbHMubWFwKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gZ2V0Q2VsbFZhbHVlKGMsIHIpO1xuICAgICAgICAgICAgaWYgKGMudmFsdWVGb3JtYXR0ZXIpIHZhbCA9IGMudmFsdWVGb3JtYXR0ZXIodmFsLCByKTtcbiAgICAgICAgICAgIHJldHVybiBlc2NhcGVDc3YodmFsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxpbmVzLnB1c2gobGluZS5qb2luKCcsJykpO1xuICAgIH1cblxuICAgIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbn1cbiJdfQ==