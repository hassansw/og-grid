export function mergeColDef(col, defaultColDef) {
    var base = defaultColDef || {};
    // Shallow merge is enough for the current scope.
    return Object.assign({}, base, col);
}
export function getCellValue(col, row) {
    var _a;
    if (!col)
        return undefined;
    if (col.valueGetter)
        return col.valueGetter(row);
    var field = col.field;
    return (_a = row) === null || _a === void 0 ? void 0 : _a[field];
}
export function sortRows(rows, cols, sortModel) {
    if (!rows || rows.length === 0)
        return [];
    if (!sortModel || sortModel.length === 0)
        return rows.slice();
    var colMap = {};
    cols.forEach(function (c) {
        colMap[String(c.field)] = c;
    });
    var active = sortModel
        .map(function (m) {
        var col = colMap[m.colId];
        if (!col || !col.sortable)
            return null;
        var dir = m.sort === 'desc' ? -1 : 1;
        var cmp = col.comparator ||
            function (a, b) {
                if (a == null && b == null)
                    return 0;
                if (a == null)
                    return -1;
                if (b == null)
                    return 1;
                if (typeof a === 'number' && typeof b === 'number')
                    return a - b;
                var as = String(a);
                var bs = String(b);
                if (as < bs)
                    return -1;
                if (as > bs)
                    return 1;
                return 0;
            };
        return { col, dir, cmp };
    })
        .filter(Boolean);
    if (active.length === 0)
        return rows.slice();
    var clone = rows.slice();
    clone.sort(function (a, b) {
        for (var i = 0; i < active.length; i++) {
            var s = active[i];
            var av = getCellValue(s.col, a);
            var bv = getCellValue(s.col, b);
            var res = s.cmp(av, bv) * s.dir;
            if (res !== 0)
                return res;
        }
        return 0;
    });
    return clone;
}
export function filterRows(rows, cols, filterModel) {
    if (!rows || rows.length === 0)
        return [];
    if (!filterModel || filterModel.length === 0)
        return rows.slice();
    var colMap = {};
    cols.forEach(function (c) {
        colMap[String(c.field)] = c;
    });
    return rows.filter(function (row) {
        for (var i = 0; i < filterModel.length; i++) {
            var f = filterModel[i];
            var col = colMap[f.colId];
            if (!col)
                continue;
            var cell = getCellValue(col, row);
            // Custom predicate wins
            if (typeof col.filter === 'function') {
                if (!col.filter(cell, row))
                    return false;
                continue;
            }
            var type = f.type || (typeof cell === 'number' ? 'number' : 'text');
            var comparator = col.filterComparator || defaultFilterComparator;
            var pass = comparator(cell, f.value, f.valueTo, type, f.matchMode || col.filterMatchMode);
            if (!pass)
                return false;
        }
        return true;
    });
}
function defaultFilterComparator(cellValue, filterValue, filterValueTo, type, matchMode) {
    if (type === 'number') {
        if (filterValue == null && filterValueTo == null)
            return true;
        var num = numberVal(cellValue);
        if (num == null)
            return false;
        var from = numberVal(filterValue);
        var to = numberVal(filterValueTo);
        if (from != null && num < from)
            return false;
        if (to != null && num > to)
            return false;
        return true;
    }
    if (type === 'date') {
        if (!filterValue && !filterValueTo)
            return true;
        var d = dateVal(cellValue);
        if (d == null)
            return false;
        var dFrom = dateVal(filterValue);
        var dTo = dateVal(filterValueTo);
        if (dFrom != null && d < dFrom)
            return false;
        if (dTo != null && d > dTo)
            return false;
        return true;
    }
    // text (default): case-insensitive contains/starts/equals
    if (filterValue == null || filterValue === '')
        return true;
    var s = safeString(cellValue);
    var fv = safeString(filterValue);
    if (matchMode === 'startsWith')
        return s.startsWith(fv);
    if (matchMode === 'equals')
        return s === fv;
    return s.indexOf(fv) >= 0;
}
function safeString(v) {
    return v == null ? '' : String(v).toLowerCase();
}
function numberVal(v) {
    if (v == null || v === '')
        return null;
    var n = Number(v);
    return isNaN(n) ? null : n;
}
function dateVal(v) {
    if (!v && v !== 0)
        return null;
    if (v instanceof Date)
        return v.getTime();
    var d = new Date(v);
    var t = d.getTime();
    return isNaN(t) ? null : t;
}
export function groupAndFlattenRows(rows, cols, groupModel, aggModel, expanded) {
    if (!groupModel || groupModel.length === 0) {
        return { flat: rows.slice(), paths: [] };
    }
    var colMap = {};
    cols.forEach(function (c) {
        colMap[String(c.field)] = c;
    });
    var aggLookup = {};
    aggModel.forEach(function (a) {
        aggLookup[a.colId] = a;
    });
    var tree = buildGroupTree(rows, groupModel, colMap, aggLookup, 0, '');
    var paths = [];
    var flat = [];
    var isExpanded = function (path) {
        if (!expanded)
            return true;
        return expanded.has(path);
    };
    flatten(tree, isExpanded, flat, paths);
    return { flat, paths };
}
function buildGroupTree(rows, groupModel, colMap, aggLookup, level, prefix) {
    var _a;
    var colId = (_a = groupModel[level]) === null || _a === void 0 ? void 0 : _a.colId;
    if (!colId)
        return [];
    var col = colMap[colId];
    var groups = {};
    rows.forEach(function (row) {
        var key = col ? getCellValue(col, row) : undefined;
        var k = key == null ? '__null__' : String(key);
        if (!groups[k])
            groups[k] = [];
        groups[k].push(row);
    });
    var keys = Object.keys(groups).sort();
    var nodes = [];
    keys.forEach(function (k) {
        var keyRows = groups[k];
        var path = prefix ? prefix + '|' + k : k;
        var children;
        var leafRows;
        if (level < groupModel.length - 1) {
            children = buildGroupTree(keyRows, groupModel, colMap, aggLookup, level + 1, path);
        }
        else {
            leafRows = keyRows;
        }
        var agg = computeAggs(leafRows || collectLeafRows(children), colMap, aggLookup);
        nodes.push({
            key: k === '__null__' ? null : maybeOriginalKey(keyRows, col),
            colId: colId,
            level: level,
            path: path,
            count: leafRows ? leafRows.length : countLeaves(children),
            agg: agg,
            children: children,
            rows: leafRows,
        });
    });
    return nodes;
}
function maybeOriginalKey(rows, col) {
    if (!col || rows.length === 0)
        return null;
    return getCellValue(col, rows[0]);
}
function collectLeafRows(nodes) {
    if (!nodes || nodes.length === 0)
        return [];
    var out = [];
    nodes.forEach(function (n) {
        if (n.rows)
            out.push.apply(out, n.rows);
        else
            out.push.apply(out, collectLeafRows(n.children));
    });
    return out;
}
function countLeaves(nodes) {
    if (!nodes || nodes.length === 0)
        return 0;
    var total = 0;
    nodes.forEach(function (n) {
        if (n.rows)
            total += n.rows.length;
        else
            total += countLeaves(n.children);
    });
    return total;
}
function computeAggs(rows, colMap, aggLookup) {
    var agg = {};
    if (!rows || rows.length === 0)
        return agg;
    Object.keys(aggLookup).forEach(function (colId) {
        var aggItem = aggLookup[colId];
        var col = colMap[colId];
        var values = rows.map(function (r) {
            return col ? getCellValue(col, r) : undefined;
        });
        var fn = resolveAggFunc(aggItem.aggFunc, col);
        agg[colId] = fn(values);
    });
    return agg;
}
export function pivotRows(rows, cols, pivot, expanded) {
    if (!pivot.enabled || !pivot.pivotCol || !pivot.valueCols.length) {
        return { rows, dynamicCols: [], paths: [] };
    }
    var colMap = {};
    cols.forEach(function (c) {
        colMap[String(c.field)] = c;
    });
    var pivotCol = colMap[pivot.pivotCol];
    if (!pivotCol)
        return { rows, dynamicCols: [], paths: [] };
    // Group rows by pivot value
    var pivotBuckets = {};
    var pivotValues = [];
    rows.forEach(function (r) {
        var key = getCellValue(pivotCol, r);
        var k = key == null ? '__null__' : String(key);
        if (!pivotBuckets[k]) {
            pivotBuckets[k] = [];
            pivotValues.push(k);
        }
        pivotBuckets[k].push(r);
    });
    // Build dynamic columns for pivot values x value cols
    var dynamicCols = [];
    pivotValues.forEach(function (pv) {
        pivot.valueCols.forEach(function (vcol) {
            var base = colMap[vcol.colId];
            dynamicCols.push({
                field: 'pv:' + pv + ':' + vcol.colId,
                headerName: ((base === null || base === void 0 ? void 0 : base.headerName) || vcol.colId) + ' ' + (pv === '__null__' ? '(blank)' : pv),
                sortable: false,
                filter: 'number',
                width: 140,
            });
        });
    });
    // Compute aggregated rows per pivot value
    var out = [];
    Object.keys(pivotBuckets).forEach(function (pv) {
        var bucket = pivotBuckets[pv];
        var row = { __pivotKey: pv };
        pivot.valueCols.forEach(function (vcol) {
            var aggItem = vcol;
            var aggFn = resolveAggFunc(aggItem.aggFunc, colMap[vcol.colId]);
            var values = bucket.map(function (r) {
                var c = colMap[vcol.colId];
                return c ? getCellValue(c, r) : undefined;
            });
            row['pv:' + pv + ':' + vcol.colId] = aggFn(values);
        });
        out.push(row);
    });
    return { rows: out, dynamicCols, paths: [] };
}
function resolveAggFunc(agg, col) {
    if (typeof agg === 'function')
        return agg;
    var numericAgg = function (values, reducer, start) {
        var nums = values
            .map(function (v) {
            return typeof v === 'number' ? v : Number(v);
        })
            .filter(function (v) {
            return !isNaN(v);
        });
        if (nums.length === 0)
            return null;
        return nums.reduce(reducer, start);
    };
    switch (agg) {
        case 'sum':
            return function (values) {
                return numericAgg(values, function (a, b) { return a + b; }, 0);
            };
        case 'min':
            return function (values) {
                return numericAgg(values, function (a, b) { return Math.min(a, b); }, Number.POSITIVE_INFINITY);
            };
        case 'max':
            return function (values) {
                return numericAgg(values, function (a, b) { return Math.max(a, b); }, Number.NEGATIVE_INFINITY);
            };
        case 'avg':
            return function (values) {
                var nums = values
                    .map(function (v) {
                    return typeof v === 'number' ? v : Number(v);
                })
                    .filter(function (v) {
                    return !isNaN(v);
                });
                if (nums.length === 0)
                    return null;
                var total = nums.reduce(function (a, b) { return a + b; }, 0);
                return total / nums.length;
            };
        case 'count':
        default:
            return function (values) {
                return values.length;
            };
    }
}
function flatten(nodes, isExpanded, out, paths) {
    nodes.forEach(function (n) {
        var gRow = {
            __group: true,
            key: n.key,
            colId: n.colId,
            level: n.level,
            path: n.path,
            count: n.count,
            agg: n.agg,
        };
        out.push(gRow);
        paths.push(n.path);
        if (isExpanded(n.path)) {
            if (n.children && n.children.length) {
                flatten(n.children, isExpanded, out, paths);
            }
            else if (n.rows) {
                out.push.apply(out, n.rows);
            }
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5naW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvb2ctZ3JpZC1jb3JlL3NyYy9saWIvZW5naW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBLE1BQU0sVUFBVSxXQUFXLENBQUksR0FBaUIsRUFBRSxhQUFxQztJQUNuRixJQUFJLElBQUksR0FBRyxhQUFhLElBQUksRUFBRSxDQUFDO0lBQy9CLGlEQUFpRDtJQUNqRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN4QyxDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FBSSxHQUFpQixFQUFFLEdBQU07O0lBQ3JELElBQUksQ0FBQyxHQUFHO1FBQUUsT0FBTyxTQUFTLENBQUM7SUFDM0IsSUFBSSxHQUFHLENBQUMsV0FBVztRQUFFLE9BQU8sR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqRCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBZ0IsQ0FBQztJQUNqQyxPQUFPLE1BQUMsR0FBVywwQ0FBRyxLQUFLLENBQUMsQ0FBQztBQUNqQyxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FDcEIsSUFBUyxFQUNULElBQW9CLEVBQ3BCLFNBQTBCO0lBRTFCLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFDMUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUM7UUFBRSxPQUFPLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUU5RCxJQUFJLE1BQU0sR0FBNkMsRUFBRSxDQUFDO0lBQzFELElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxD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QyxJQUFJLENBQUMsRUFBRTtZQUNwQixJQUFJLENBQUMsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUU7Z0JBQ2pDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDL0M7aUJBQU0sSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFO2dCQUNmLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBVyxDQUFDLENBQUM7YUFDdEM7U0FDSjtJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQWdnTW9kZWxJdGVtLFxuICAgIEFnZ3JlZ2F0aW9uVHlwZSxcbiAgICBDb2x1bW5EZWYsXG4gICAgRmlsdGVyTW9kZWxJdGVtLFxuICAgIEdyb3VwTW9kZWxJdGVtLFxuICAgIFJvd1ZpZXcsXG4gICAgU29ydE1vZGVsSXRlbSxcbiAgICBHcm91cFZpZXdSb3csXG4gICAgVGV4dEZpbHRlck1vZGUsXG4gICAgUGl2b3RNb2RlbCxcbn0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZUNvbERlZjxUPihjb2w6IENvbHVtbkRlZjxUPiwgZGVmYXVsdENvbERlZj86IFBhcnRpYWw8Q29sdW1uRGVmPFQ+Pik6IENvbHVtbkRlZjxUPiB7XG4gICAgdmFyIGJhc2UgPSBkZWZhdWx0Q29sRGVmIHx8IHt9O1xuICAgIC8vIFNoYWxsb3cgbWVyZ2UgaXMgZW5vdWdoIGZvciB0aGUgY3VycmVudCBzY29wZS5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgYmFzZSwgY29sKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENlbGxWYWx1ZTxUPihjb2w6IENvbHVtbkRlZjxUPiwgcm93OiBUKTogYW55IHtcbiAgICBpZiAoIWNvbCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBpZiAoY29sLnZhbHVlR2V0dGVyKSByZXR1cm4gY29sLnZhbHVlR2V0dGVyKHJvdyk7XG4gICAgdmFyIGZpZWxkID0gY29sLmZpZWxkIGFzIGtleW9mIFQ7XG4gICAgcmV0dXJuIChyb3cgYXMgYW55KT8uW2ZpZWxkXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRSb3dzPFQ+KFxuICAgIHJvd3M6IFRbXSxcbiAgICBjb2xzOiBDb2x1bW5EZWY8VD5bXSxcbiAgICBzb3J0TW9kZWw6IFNvcnRNb2RlbEl0ZW1bXVxuKTogVFtdIHtcbiAgICBpZiAoIXJvd3MgfHwgcm93cy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgICBpZiAoIXNvcnRNb2RlbCB8fCBzb3J0TW9kZWwubGVuZ3RoID09PSAwKSByZXR1cm4gcm93cy5zbGljZSgpO1xuXG4gICAgdmFyIGNvbE1hcDogUmVjb3JkPHN0cmluZywgQ29sdW1uRGVmPFQ+IHwgdW5kZWZpbmVkPiA9IHt9O1xuICAgIGNvbHMuZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICBjb2xNYXBbU3RyaW5nKGMuZmllbGQpXSA9IGM7XG4gICAgfSk7XG5cbiAgICB2YXIgYWN0aXZlID0gc29ydE1vZGVsXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICAgIHZhciBjb2wgPSBjb2xNYXBbbS5jb2xJZF07XG4gICAgICAgICAgICBpZiAoIWNvbCB8fCAhY29sLnNvcnRhYmxlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHZhciBkaXIgPSBtLnNvcnQgPT09ICdkZXNjJyA/IC0xIDogMTtcbiAgICAgICAgICAgIHZhciBjbXAgPVxuICAgICAgICAgICAgICAgIGNvbC5jb21wYXJhdG9yIHx8XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGE6IGFueSwgYjogYW55KTogbnVtYmVyIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEgPT0gbnVsbCAmJiBiID09IG51bGwpIHJldHVybiAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYSA9PSBudWxsKSByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChiID09IG51bGwpIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGEgPT09ICdudW1iZXInICYmIHR5cGVvZiBiID09PSAnbnVtYmVyJykgcmV0dXJuIGEgLSBiO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXMgPSBTdHJpbmcoYSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBicyA9IFN0cmluZyhiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzIDwgYnMpIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzID4gYnMpIHJldHVybiAxO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgY29sLCBkaXIsIGNtcCB9O1xuICAgICAgICB9KVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pIGFzIHsgY29sOiBDb2x1bW5EZWY8VD47IGRpcjogbnVtYmVyOyBjbXA6IChhOiBhbnksIGI6IGFueSkgPT4gbnVtYmVyIH1bXTtcblxuICAgIGlmIChhY3RpdmUubGVuZ3RoID09PSAwKSByZXR1cm4gcm93cy5zbGljZSgpO1xuXG4gICAgdmFyIGNsb25lID0gcm93cy5zbGljZSgpO1xuICAgIGNsb25lLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY3RpdmUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBzID0gYWN0aXZlW2ldO1xuICAgICAgICAgICAgdmFyIGF2ID0gZ2V0Q2VsbFZhbHVlKHMuY29sLCBhKTtcbiAgICAgICAgICAgIHZhciBidiA9IGdldENlbGxWYWx1ZShzLmNvbCwgYik7XG4gICAgICAgICAgICB2YXIgcmVzID0gcy5jbXAoYXYsIGJ2KSAqIHMuZGlyO1xuICAgICAgICAgICAgaWYgKHJlcyAhPT0gMCkgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9KTtcbiAgICByZXR1cm4gY2xvbmU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJSb3dzPFQ+KFxuICAgIHJvd3M6IFRbXSxcbiAgICBjb2xzOiBDb2x1bW5EZWY8VD5bXSxcbiAgICBmaWx0ZXJNb2RlbDogRmlsdGVyTW9kZWxJdGVtW11cbik6IFRbXSB7XG4gICAgaWYgKCFyb3dzIHx8IHJvd3MubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG4gICAgaWYgKCFmaWx0ZXJNb2RlbCB8fCBmaWx0ZXJNb2RlbC5sZW5ndGggPT09IDApIHJldHVybiByb3dzLnNsaWNlKCk7XG5cbiAgICB2YXIgY29sTWFwOiBSZWNvcmQ8c3RyaW5nLCBDb2x1bW5EZWY8VD4gfCB1bmRlZmluZWQ+ID0ge307XG4gICAgY29scy5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIGNvbE1hcFtTdHJpbmcoYy5maWVsZCldID0gYztcbiAgICB9KTtcblxuICAgIHJldHVybiByb3dzLmZpbHRlcihmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsdGVyTW9kZWwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBmID0gZmlsdGVyTW9kZWxbaV07XG4gICAgICAgICAgICB2YXIgY29sID0gY29sTWFwW2YuY29sSWRdO1xuICAgICAgICAgICAgaWYgKCFjb2wpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICB2YXIgY2VsbCA9IGdldENlbGxWYWx1ZShjb2wsIHJvdyk7XG5cbiAgICAgICAgICAgIC8vIEN1c3RvbSBwcmVkaWNhdGUgd2luc1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb2wuZmlsdGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjb2wuZmlsdGVyKGNlbGwsIHJvdykpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgIHZhciB0eXBlID0gZi50eXBlIHx8ICh0eXBlb2YgY2VsbCA9PT0gJ251bWJlcicgPyAnbnVtYmVyJyA6ICd0ZXh0Jyk7XG4gICAgdmFyIGNvbXBhcmF0b3IgPSBjb2wuZmlsdGVyQ29tcGFyYXRvciB8fCBkZWZhdWx0RmlsdGVyQ29tcGFyYXRvcjtcbiAgICB2YXIgcGFzcyA9IGNvbXBhcmF0b3IoY2VsbCwgZi52YWx1ZSwgZi52YWx1ZVRvLCB0eXBlLCBmLm1hdGNoTW9kZSB8fCBjb2wuZmlsdGVyTWF0Y2hNb2RlKTtcbiAgICAgICAgICAgIGlmICghcGFzcykgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0RmlsdGVyQ29tcGFyYXRvcihcbiAgICBjZWxsVmFsdWU6IGFueSxcbiAgICBmaWx0ZXJWYWx1ZTogYW55LFxuICAgIGZpbHRlclZhbHVlVG86IGFueSxcbiAgICB0eXBlOiBGaWx0ZXJNb2RlbEl0ZW1bJ3R5cGUnXSxcbiAgICBtYXRjaE1vZGU/OiBUZXh0RmlsdGVyTW9kZVxuKTogYm9vbGVhbiB7XG4gICAgaWYgKHR5cGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmIChmaWx0ZXJWYWx1ZSA9PSBudWxsICYmIGZpbHRlclZhbHVlVG8gPT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gICAgICAgIHZhciBudW0gPSBudW1iZXJWYWwoY2VsbFZhbHVlKTtcbiAgICAgICAgaWYgKG51bSA9PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHZhciBmcm9tID0gbnVtYmVyVmFsKGZpbHRlclZhbHVlKTtcbiAgICAgICAgdmFyIHRvID0gbnVtYmVyVmFsKGZpbHRlclZhbHVlVG8pO1xuICAgICAgICBpZiAoZnJvbSAhPSBudWxsICYmIG51bSA8IGZyb20pIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHRvICE9IG51bGwgJiYgbnVtID4gdG8pIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09ICdkYXRlJykge1xuICAgICAgICBpZiAoIWZpbHRlclZhbHVlICYmICFmaWx0ZXJWYWx1ZVRvKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgdmFyIGQgPSBkYXRlVmFsKGNlbGxWYWx1ZSk7XG4gICAgICAgIGlmIChkID09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgICAgICAgdmFyIGRGcm9tID0gZGF0ZVZhbChmaWx0ZXJWYWx1ZSk7XG4gICAgICAgIHZhciBkVG8gPSBkYXRlVmFsKGZpbHRlclZhbHVlVG8pO1xuICAgICAgICBpZiAoZEZyb20gIT0gbnVsbCAmJiBkIDwgZEZyb20pIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKGRUbyAhPSBudWxsICYmIGQgPiBkVG8pIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gdGV4dCAoZGVmYXVsdCk6IGNhc2UtaW5zZW5zaXRpdmUgY29udGFpbnMvc3RhcnRzL2VxdWFsc1xuICAgIGlmIChmaWx0ZXJWYWx1ZSA9PSBudWxsIHx8IGZpbHRlclZhbHVlID09PSAnJykgcmV0dXJuIHRydWU7XG4gICAgdmFyIHMgPSBzYWZlU3RyaW5nKGNlbGxWYWx1ZSk7XG4gICAgdmFyIGZ2ID0gc2FmZVN0cmluZyhmaWx0ZXJWYWx1ZSk7XG4gICAgaWYgKG1hdGNoTW9kZSA9PT0gJ3N0YXJ0c1dpdGgnKSByZXR1cm4gcy5zdGFydHNXaXRoKGZ2KTtcbiAgICBpZiAobWF0Y2hNb2RlID09PSAnZXF1YWxzJykgcmV0dXJuIHMgPT09IGZ2O1xuICAgIHJldHVybiBzLmluZGV4T2YoZnYpID49IDA7XG59XG5cbmZ1bmN0aW9uIHNhZmVTdHJpbmcodjogYW55KTogc3RyaW5nIHtcbiAgICByZXR1cm4gdiA9PSBudWxsID8gJycgOiBTdHJpbmcodikudG9Mb3dlckNhc2UoKTtcbn1cblxuZnVuY3Rpb24gbnVtYmVyVmFsKHY6IGFueSk6IG51bWJlciB8IG51bGwge1xuICAgIGlmICh2ID09IG51bGwgfHwgdiA9PT0gJycpIHJldHVybiBudWxsO1xuICAgIHZhciBuID0gTnVtYmVyKHYpO1xuICAgIHJldHVybiBpc05hTihuKSA/IG51bGwgOiBuO1xufVxuXG5mdW5jdGlvbiBkYXRlVmFsKHY6IGFueSk6IG51bWJlciB8IG51bGwge1xuICAgIGlmICghdiAmJiB2ICE9PSAwKSByZXR1cm4gbnVsbDtcbiAgICBpZiAodiBpbnN0YW5jZW9mIERhdGUpIHJldHVybiB2LmdldFRpbWUoKTtcbiAgICB2YXIgZCA9IG5ldyBEYXRlKHYpO1xuICAgIHZhciB0ID0gZC5nZXRUaW1lKCk7XG4gICAgcmV0dXJuIGlzTmFOKHQpID8gbnVsbCA6IHQ7XG59XG5cbi8vIC0tLS0tLS0tIEdyb3VwaW5nICYgQWdncmVnYXRpb24gLS0tLS0tLS1cblxuaW50ZXJmYWNlIEdyb3VwTm9kZTxUID0gYW55PiB7XG4gICAga2V5OiBhbnk7XG4gICAgY29sSWQ6IHN0cmluZztcbiAgICBsZXZlbDogbnVtYmVyO1xuICAgIHBhdGg6IHN0cmluZztcbiAgICBjb3VudDogbnVtYmVyO1xuICAgIGFnZzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICBjaGlsZHJlbj86IEdyb3VwTm9kZTxUPltdO1xuICAgIHJvd3M/OiBUW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cEFuZEZsYXR0ZW5Sb3dzPFQ+KFxuICAgIHJvd3M6IFRbXSxcbiAgICBjb2xzOiBDb2x1bW5EZWY8VD5bXSxcbiAgICBncm91cE1vZGVsOiBHcm91cE1vZGVsSXRlbVtdLFxuICAgIGFnZ01vZGVsOiBBZ2dNb2RlbEl0ZW1bXSxcbiAgICBleHBhbmRlZDogU2V0PHN0cmluZz4gfCBudWxsIHwgdW5kZWZpbmVkXG4pOiB7IGZsYXQ6IEFycmF5PFJvd1ZpZXc8VD4+OyBwYXRoczogc3RyaW5nW10gfSB7XG4gICAgaWYgKCFncm91cE1vZGVsIHx8IGdyb3VwTW9kZWwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7IGZsYXQ6IHJvd3Muc2xpY2UoKSBhcyBBcnJheTxSb3dWaWV3PFQ+PiwgcGF0aHM6IFtdIH07XG4gICAgfVxuXG4gICAgdmFyIGNvbE1hcDogUmVjb3JkPHN0cmluZywgQ29sdW1uRGVmPFQ+IHwgdW5kZWZpbmVkPiA9IHt9O1xuICAgIGNvbHMuZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICBjb2xNYXBbU3RyaW5nKGMuZmllbGQpXSA9IGM7XG4gICAgfSk7XG5cbiAgICB2YXIgYWdnTG9va3VwOiBSZWNvcmQ8c3RyaW5nLCBBZ2dNb2RlbEl0ZW0+ID0ge307XG4gICAgYWdnTW9kZWwuZm9yRWFjaChmdW5jdGlvbiAoYSkge1xuICAgICAgICBhZ2dMb29rdXBbYS5jb2xJZF0gPSBhO1xuICAgIH0pO1xuXG4gICAgdmFyIHRyZWUgPSBidWlsZEdyb3VwVHJlZShyb3dzLCBncm91cE1vZGVsLCBjb2xNYXAsIGFnZ0xvb2t1cCwgMCwgJycpO1xuICAgIHZhciBwYXRoczogc3RyaW5nW10gPSBbXTtcbiAgICB2YXIgZmxhdDogQXJyYXk8Um93VmlldzxUPj4gPSBbXTtcblxuICAgIHZhciBpc0V4cGFuZGVkID0gZnVuY3Rpb24gKHBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIWV4cGFuZGVkKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGV4cGFuZGVkLmhhcyhwYXRoKTtcbiAgICB9O1xuXG4gICAgZmxhdHRlbih0cmVlLCBpc0V4cGFuZGVkLCBmbGF0LCBwYXRocyk7XG4gICAgcmV0dXJuIHsgZmxhdCwgcGF0aHMgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGRHcm91cFRyZWU8VD4oXG4gICAgcm93czogVFtdLFxuICAgIGdyb3VwTW9kZWw6IEdyb3VwTW9kZWxJdGVtW10sXG4gICAgY29sTWFwOiBSZWNvcmQ8c3RyaW5nLCBDb2x1bW5EZWY8VD4gfCB1bmRlZmluZWQ+LFxuICAgIGFnZ0xvb2t1cDogUmVjb3JkPHN0cmluZywgQWdnTW9kZWxJdGVtPixcbiAgICBsZXZlbDogbnVtYmVyLFxuICAgIHByZWZpeDogc3RyaW5nXG4pOiBHcm91cE5vZGU8VD5bXSB7XG4gICAgdmFyIGNvbElkID0gZ3JvdXBNb2RlbFtsZXZlbF0/LmNvbElkO1xuICAgIGlmICghY29sSWQpIHJldHVybiBbXTtcbiAgICB2YXIgY29sID0gY29sTWFwW2NvbElkXTtcbiAgICB2YXIgZ3JvdXBzOiBSZWNvcmQ8c3RyaW5nLCBUW10+ID0ge307XG5cbiAgICByb3dzLmZvckVhY2goZnVuY3Rpb24gKHJvdykge1xuICAgICAgICB2YXIga2V5ID0gY29sID8gZ2V0Q2VsbFZhbHVlKGNvbCwgcm93KSA6IHVuZGVmaW5lZDtcbiAgICAgICAgdmFyIGsgPSBrZXkgPT0gbnVsbCA/ICdfX251bGxfXycgOiBTdHJpbmcoa2V5KTtcbiAgICAgICAgaWYgKCFncm91cHNba10pIGdyb3Vwc1trXSA9IFtdO1xuICAgICAgICBncm91cHNba10ucHVzaChyb3cpO1xuICAgIH0pO1xuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhncm91cHMpLnNvcnQoKTtcbiAgICB2YXIgbm9kZXM6IEdyb3VwTm9kZTxUPltdID0gW107XG5cbiAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGspIHtcbiAgICAgICAgdmFyIGtleVJvd3MgPSBncm91cHNba107XG4gICAgICAgIHZhciBwYXRoID0gcHJlZml4ID8gcHJlZml4ICsgJ3wnICsgayA6IGs7XG4gICAgICAgIHZhciBjaGlsZHJlbjogR3JvdXBOb2RlPFQ+W10gfCB1bmRlZmluZWQ7XG4gICAgICAgIHZhciBsZWFmUm93czogVFtdIHwgdW5kZWZpbmVkO1xuXG4gICAgICAgIGlmIChsZXZlbCA8IGdyb3VwTW9kZWwubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgY2hpbGRyZW4gPSBidWlsZEdyb3VwVHJlZShrZXlSb3dzLCBncm91cE1vZGVsLCBjb2xNYXAsIGFnZ0xvb2t1cCwgbGV2ZWwgKyAxLCBwYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxlYWZSb3dzID0ga2V5Um93cztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhZ2cgPSBjb21wdXRlQWdncyhsZWFmUm93cyB8fCBjb2xsZWN0TGVhZlJvd3MoY2hpbGRyZW4pLCBjb2xNYXAsIGFnZ0xvb2t1cCk7XG5cbiAgICAgICAgbm9kZXMucHVzaCh7XG4gICAgICAgICAgICBrZXk6IGsgPT09ICdfX251bGxfXycgPyBudWxsIDogbWF5YmVPcmlnaW5hbEtleShrZXlSb3dzLCBjb2wpLFxuICAgICAgICAgICAgY29sSWQ6IGNvbElkLFxuICAgICAgICAgICAgbGV2ZWw6IGxldmVsLFxuICAgICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgICAgIGNvdW50OiBsZWFmUm93cyA/IGxlYWZSb3dzLmxlbmd0aCA6IGNvdW50TGVhdmVzKGNoaWxkcmVuKSxcbiAgICAgICAgICAgIGFnZzogYWdnLFxuICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLFxuICAgICAgICAgICAgcm93czogbGVhZlJvd3MsXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5vZGVzO1xufVxuXG5mdW5jdGlvbiBtYXliZU9yaWdpbmFsS2V5PFQ+KHJvd3M6IFRbXSwgY29sPzogQ29sdW1uRGVmPFQ+KTogYW55IHtcbiAgICBpZiAoIWNvbCB8fCByb3dzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIGdldENlbGxWYWx1ZShjb2wsIHJvd3NbMF0pO1xufVxuXG5mdW5jdGlvbiBjb2xsZWN0TGVhZlJvd3M8VD4obm9kZXM/OiBHcm91cE5vZGU8VD5bXSk6IFRbXSB7XG4gICAgaWYgKCFub2RlcyB8fCBub2Rlcy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgICB2YXIgb3V0OiBUW10gPSBbXTtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIGlmIChuLnJvd3MpIG91dC5wdXNoLmFwcGx5KG91dCwgbi5yb3dzKTtcbiAgICAgICAgZWxzZSBvdXQucHVzaC5hcHBseShvdXQsIGNvbGxlY3RMZWFmUm93cyhuLmNoaWxkcmVuKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG91dDtcbn1cblxuZnVuY3Rpb24gY291bnRMZWF2ZXM8VD4obm9kZXM/OiBHcm91cE5vZGU8VD5bXSk6IG51bWJlciB7XG4gICAgaWYgKCFub2RlcyB8fCBub2Rlcy5sZW5ndGggPT09IDApIHJldHVybiAwO1xuICAgIHZhciB0b3RhbCA9IDA7XG4gICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICBpZiAobi5yb3dzKSB0b3RhbCArPSBuLnJvd3MubGVuZ3RoO1xuICAgICAgICBlbHNlIHRvdGFsICs9IGNvdW50TGVhdmVzKG4uY2hpbGRyZW4pO1xuICAgIH0pO1xuICAgIHJldHVybiB0b3RhbDtcbn1cblxuZnVuY3Rpb24gY29tcHV0ZUFnZ3M8VD4oXG4gICAgcm93czogVFtdLFxuICAgIGNvbE1hcDogUmVjb3JkPHN0cmluZywgQ29sdW1uRGVmPFQ+IHwgdW5kZWZpbmVkPixcbiAgICBhZ2dMb29rdXA6IFJlY29yZDxzdHJpbmcsIEFnZ01vZGVsSXRlbT5cbik6IFJlY29yZDxzdHJpbmcsIGFueT4ge1xuICAgIHZhciBhZ2c6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICBpZiAoIXJvd3MgfHwgcm93cy5sZW5ndGggPT09IDApIHJldHVybiBhZ2c7XG5cbiAgICBPYmplY3Qua2V5cyhhZ2dMb29rdXApLmZvckVhY2goZnVuY3Rpb24gKGNvbElkKSB7XG4gICAgICAgIHZhciBhZ2dJdGVtID0gYWdnTG9va3VwW2NvbElkXTtcbiAgICAgICAgdmFyIGNvbCA9IGNvbE1hcFtjb2xJZF07XG4gICAgICAgIHZhciB2YWx1ZXMgPSByb3dzLm1hcChmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbCA/IGdldENlbGxWYWx1ZShjb2wsIHIpIDogdW5kZWZpbmVkO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGZuID0gcmVzb2x2ZUFnZ0Z1bmMoYWdnSXRlbS5hZ2dGdW5jLCBjb2wpO1xuICAgICAgICBhZ2dbY29sSWRdID0gZm4odmFsdWVzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBhZ2c7XG59XG5cbi8vIC0tLS0tLS0tIFBpdm90IChzaW5nbGUgcGl2b3QgY29sdW1uIE1WUCkgLS0tLS0tLS1cblxuZXhwb3J0IGludGVyZmFjZSBQaXZvdFJlc3VsdDxUID0gYW55PiB7XG4gICAgcm93czogVFtdO1xuICAgIGR5bmFtaWNDb2xzOiBDb2x1bW5EZWY8VD5bXTtcbiAgICBwYXRoczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwaXZvdFJvd3M8VD4oXG4gICAgcm93czogVFtdLFxuICAgIGNvbHM6IENvbHVtbkRlZjxUPltdLFxuICAgIHBpdm90OiBQaXZvdE1vZGVsLFxuICAgIGV4cGFuZGVkOiBTZXQ8c3RyaW5nPiB8IG51bGwgfCB1bmRlZmluZWRcbik6IFBpdm90UmVzdWx0PFQ+IHtcbiAgICBpZiAoIXBpdm90LmVuYWJsZWQgfHwgIXBpdm90LnBpdm90Q29sIHx8ICFwaXZvdC52YWx1ZUNvbHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB7IHJvd3MsIGR5bmFtaWNDb2xzOiBbXSwgcGF0aHM6IFtdIH07XG4gICAgfVxuXG4gICAgdmFyIGNvbE1hcDogUmVjb3JkPHN0cmluZywgQ29sdW1uRGVmPFQ+IHwgdW5kZWZpbmVkPiA9IHt9O1xuICAgIGNvbHMuZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICBjb2xNYXBbU3RyaW5nKGMuZmllbGQpXSA9IGM7XG4gICAgfSk7XG5cbiAgICB2YXIgcGl2b3RDb2wgPSBjb2xNYXBbcGl2b3QucGl2b3RDb2xdO1xuICAgIGlmICghcGl2b3RDb2wpIHJldHVybiB7IHJvd3MsIGR5bmFtaWNDb2xzOiBbXSwgcGF0aHM6IFtdIH07XG5cbiAgICAvLyBHcm91cCByb3dzIGJ5IHBpdm90IHZhbHVlXG4gICAgdmFyIHBpdm90QnVja2V0czogUmVjb3JkPHN0cmluZywgVFtdPiA9IHt9O1xuICAgIHZhciBwaXZvdFZhbHVlczogYW55W10gPSBbXTtcbiAgICByb3dzLmZvckVhY2goZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgdmFyIGtleSA9IGdldENlbGxWYWx1ZShwaXZvdENvbCEsIHIpO1xuICAgICAgICB2YXIgayA9IGtleSA9PSBudWxsID8gJ19fbnVsbF9fJyA6IFN0cmluZyhrZXkpO1xuICAgICAgICBpZiAoIXBpdm90QnVja2V0c1trXSkge1xuICAgICAgICAgICAgcGl2b3RCdWNrZXRzW2tdID0gW107XG4gICAgICAgICAgICBwaXZvdFZhbHVlcy5wdXNoKGspO1xuICAgICAgICB9XG4gICAgICAgIHBpdm90QnVja2V0c1trXS5wdXNoKHIpO1xuICAgIH0pO1xuXG4gICAgLy8gQnVpbGQgZHluYW1pYyBjb2x1bW5zIGZvciBwaXZvdCB2YWx1ZXMgeCB2YWx1ZSBjb2xzXG4gICAgdmFyIGR5bmFtaWNDb2xzOiBDb2x1bW5EZWY8VD5bXSA9IFtdO1xuICAgIHBpdm90VmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHB2KSB7XG4gICAgICAgIHBpdm90LnZhbHVlQ29scy5mb3JFYWNoKGZ1bmN0aW9uICh2Y29sKSB7XG4gICAgICAgICAgICB2YXIgYmFzZSA9IGNvbE1hcFt2Y29sLmNvbElkXTtcbiAgICAgICAgICAgIGR5bmFtaWNDb2xzLnB1c2goe1xuICAgICAgICAgICAgICAgIGZpZWxkOiAncHY6JyArIHB2ICsgJzonICsgdmNvbC5jb2xJZCxcbiAgICAgICAgICAgICAgICBoZWFkZXJOYW1lOiAoYmFzZT8uaGVhZGVyTmFtZSB8fCB2Y29sLmNvbElkKSArICcgJyArIChwdiA9PT0gJ19fbnVsbF9fJyA/ICcoYmxhbmspJyA6IHB2KSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZmlsdGVyOiAnbnVtYmVyJyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTQwLFxuICAgICAgICAgICAgfSBhcyBhbnkpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIENvbXB1dGUgYWdncmVnYXRlZCByb3dzIHBlciBwaXZvdCB2YWx1ZVxuICAgIHZhciBvdXQ6IGFueVtdID0gW107XG4gICAgT2JqZWN0LmtleXMocGl2b3RCdWNrZXRzKS5mb3JFYWNoKGZ1bmN0aW9uIChwdikge1xuICAgICAgICB2YXIgYnVja2V0ID0gcGl2b3RCdWNrZXRzW3B2XTtcbiAgICAgICAgdmFyIHJvdzogYW55ID0geyBfX3Bpdm90S2V5OiBwdiB9O1xuICAgICAgICBwaXZvdC52YWx1ZUNvbHMuZm9yRWFjaChmdW5jdGlvbiAodmNvbCkge1xuICAgICAgICAgICAgdmFyIGFnZ0l0ZW0gPSB2Y29sO1xuICAgICAgICAgICAgdmFyIGFnZ0ZuID0gcmVzb2x2ZUFnZ0Z1bmMoYWdnSXRlbS5hZ2dGdW5jLCBjb2xNYXBbdmNvbC5jb2xJZF0pO1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGJ1Y2tldC5tYXAoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGNvbE1hcFt2Y29sLmNvbElkXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYyA/IGdldENlbGxWYWx1ZShjLCByKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcm93WydwdjonICsgcHYgKyAnOicgKyB2Y29sLmNvbElkXSA9IGFnZ0ZuKHZhbHVlcyk7XG4gICAgICAgIH0pO1xuICAgICAgICBvdXQucHVzaChyb3cgYXMgVCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4geyByb3dzOiBvdXQsIGR5bmFtaWNDb2xzLCBwYXRoczogW10gfTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUFnZ0Z1bmM8VD4oXG4gICAgYWdnOiBBZ2dyZWdhdGlvblR5cGUgfCAoKHZhbHVlczogYW55W10pID0+IGFueSksXG4gICAgY29sPzogQ29sdW1uRGVmPFQ+XG4pOiAodmFsdWVzOiBhbnlbXSkgPT4gYW55IHtcbiAgICBpZiAodHlwZW9mIGFnZyA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIGFnZztcblxuICAgIHZhciBudW1lcmljQWdnID0gZnVuY3Rpb24gKHZhbHVlczogYW55W10sIHJlZHVjZXI6IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gbnVtYmVyLCBzdGFydDogbnVtYmVyKTogYW55IHtcbiAgICAgICAgdmFyIG51bXMgPSB2YWx1ZXNcbiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHYgPT09ICdudW1iZXInID8gdiA6IE51bWJlcih2KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFpc05hTih2KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBpZiAobnVtcy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gbnVtcy5yZWR1Y2UocmVkdWNlciwgc3RhcnQpO1xuICAgIH07XG5cbiAgICBzd2l0Y2ggKGFnZykge1xuICAgICAgICBjYXNlICdzdW0nOlxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZXM6IGFueVtdKTogYW55IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpY0FnZyh2YWx1ZXMsIGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhICsgYjsgfSwgMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICBjYXNlICdtaW4nOlxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZXM6IGFueVtdKTogYW55IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpY0FnZyh2YWx1ZXMsIGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBNYXRoLm1pbihhLCBiKTsgfSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgJ21heCc6XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlczogYW55W10pOiBhbnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudW1lcmljQWdnKHZhbHVlcywgZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIE1hdGgubWF4KGEsIGIpOyB9LCBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgY2FzZSAnYXZnJzpcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWVzOiBhbnlbXSk6IGFueSB7XG4gICAgICAgICAgICAgICAgdmFyIG51bXMgPSB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSAnbnVtYmVyJyA/IHYgOiBOdW1iZXIodik7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhaXNOYU4odik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChudW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHRvdGFsID0gbnVtcy5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEgKyBiOyB9LCAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG90YWwgLyBudW1zLmxlbmd0aDtcbiAgICAgICAgICAgIH07XG4gICAgICAgIGNhc2UgJ2NvdW50JzpcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWVzOiBhbnlbXSk6IGFueSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcy5sZW5ndGg7XG4gICAgICAgICAgICB9O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZmxhdHRlbjxUPihcbiAgICBub2RlczogR3JvdXBOb2RlPFQ+W10sXG4gICAgaXNFeHBhbmRlZDogKHBhdGg6IHN0cmluZykgPT4gYm9vbGVhbixcbiAgICBvdXQ6IEFycmF5PFJvd1ZpZXc8VD4+LFxuICAgIHBhdGhzOiBzdHJpbmdbXVxuKTogdm9pZCB7XG4gICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICB2YXIgZ1JvdzogR3JvdXBWaWV3Um93PFQ+ID0ge1xuICAgICAgICAgICAgX19ncm91cDogdHJ1ZSxcbiAgICAgICAgICAgIGtleTogbi5rZXksXG4gICAgICAgICAgICBjb2xJZDogbi5jb2xJZCxcbiAgICAgICAgICAgIGxldmVsOiBuLmxldmVsLFxuICAgICAgICAgICAgcGF0aDogbi5wYXRoLFxuICAgICAgICAgICAgY291bnQ6IG4uY291bnQsXG4gICAgICAgICAgICBhZ2c6IG4uYWdnLFxuICAgICAgICB9O1xuICAgICAgICBvdXQucHVzaChnUm93KTtcbiAgICAgICAgcGF0aHMucHVzaChuLnBhdGgpO1xuXG4gICAgICAgIGlmIChpc0V4cGFuZGVkKG4ucGF0aCkpIHtcbiAgICAgICAgICAgIGlmIChuLmNoaWxkcmVuICYmIG4uY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZmxhdHRlbihuLmNoaWxkcmVuLCBpc0V4cGFuZGVkLCBvdXQsIHBhdGhzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobi5yb3dzKSB7XG4gICAgICAgICAgICAgICAgb3V0LnB1c2guYXBwbHkob3V0LCBuLnJvd3MgYXMgYW55KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4iXX0=